<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>EBI Comcast Roadshow - Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #FFF8F0;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 40px rgba(255, 255, 255, 0.15);
            text-align: center;
            animation: fadeInDown 0.6s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            color: #000000;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .welcome-text {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .subtitle {
            color: #999;
            font-size: 1rem;
            font-style: italic;
        }

        .welcome-text .name {
            color: #000000;
            font-weight: 700;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .projects-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .project-card {
                padding: 20px;
                border-radius: 15px;
            }
        }

        @media (max-width: 480px) {
            .projects-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .project-card {
                padding: 15px;
                border-radius: 12px;
            }
        }

        /* Roadmap Journey Container */
        .roadmap-container {
            margin-bottom: 30px;
        }        /* Hotspot hover effect */
        .hotspot {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .hotspot:hover {
            fill: rgba(255, 255, 255, 0.2) !important;
            stroke: #fff !important;
        }        /* Completion tick animations */
        @keyframes tickAppear {
            0% {
                opacity: 0;
                transform: scale(0.3) rotate(-180deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) rotate(0deg);
            }
            70% {
                transform: scale(0.9) rotate(10deg);
            }
            85% {
                transform: scale(1.1) rotate(-5deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        @keyframes tickPulse {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px rgba(34, 197, 94, 0.5));
            }
            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.8));
            }
        }

        @keyframes circleGlow {
            0%, 100% {
                stroke: #16a34a;
                fill: rgba(34, 197, 94, 0.8);
            }
            50% {
                stroke: #22c55e;
                fill: rgba(34, 197, 94, 1);
            }
        }

        @keyframes checkmarkDraw {
            0% {
                stroke-dasharray: 50;
                stroke-dashoffset: 50;
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                stroke-dasharray: 50;
                stroke-dashoffset: 0;
                opacity: 1;
            }
        }

        .completion-tick {
            animation: tickAppear 1s ease-out;
        }

        .completion-tick circle {
            animation: circleGlow 2s ease-in-out infinite;
        }

        .completion-tick path {
            animation: checkmarkDraw 0.8s ease-out 0.5s both, tickPulse 3s ease-in-out infinite 1.5s;
        }

        .completion-tick:hover {
            animation: tickPulse 0.5s ease-in-out;
        }

        /* Disable pointer events for completed projects */
        .hotspot.completed {
            pointer-events: none;
            opacity: 0.5;
            cursor: default;
        }

        /* Leaderboard - HIDDEN */
        .leaderboard {
            display: none;
        }

        /* Logout Button */
        .logout-btn {
            background: #FF0000;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(255, 0, 0, 0.3);
        }

        .logout-btn:hover {
            background: #cc0000;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 0, 0, 0.4);
        }

        .logout-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .welcome-text {
                font-size: 1rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .logout-btn {
                padding: 12px 30px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ DataWorks Roadshow Journey</h1>
            <p class="welcome-text">Welcome, {{ employee_name }}!</p>
            <p class="subtitle">Follow the path and explore all 6 teams</p>
        </div>

        <div class="roadmap-container">
            <!-- Interactive Banner Image with Clickable Regions -->
            <div style="position: relative; max-width: 900px; margin: 0 auto;">
                <img id="bannerImage" src="{{ url_for('static', filename='road_show_banner.png') }}" alt="Roadshow Journey" style="width: 100%; display: block; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                  <!-- SVG Overlay for Clickable Regions -->
                <svg id="clickableOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;" viewBox="0 0 1000 1500" preserveAspectRatio="xMidYMid meet">
                    <!-- PMO - Circle at 140, 289 -->
                    <circle cx="140" cy="289" r="70" fill="transparent" stroke="transparent" stroke-width="3" class="hotspot" data-project="1" />
                    
                    <!-- Data & Governance - Circle at 801, 500 -->
                    <circle cx="801" cy="500" r="70" fill="transparent" stroke="transparent" stroke-width="3" class="hotspot" data-project="2" />
                    
                    <!-- Analytics & Reporting - Circle at 234, 664 -->
                    <circle cx="234" cy="664" r="70" fill="transparent" stroke="transparent" stroke-width="3" class="hotspot" data-project="3" />
                    
                    <!-- Machine Learning Solutions - Circle at 823, 930 -->
                    <circle cx="823" cy="930" r="70" fill="transparent" stroke="transparent" stroke-width="3" class="hotspot" data-project="4" />
                    
                    <!-- Consumer Research & Insights - Circle at 201, 1040 -->
                    <circle cx="201" cy="1040" r="70" fill="transparent" stroke="transparent" stroke-width="3" class="hotspot" data-project="5" />
                    
                    <!-- Martech - Circle at 559, 1408 -->
                    <circle cx="559" cy="1408" r="70" fill="transparent" stroke="transparent" stroke-width="3" class="hotspot" data-project="6" />                    <!-- Completion Tick Icons (initially hidden) -->
                    <!-- PMO Tick -->
                    <g class="completion-tick" data-project="1" style="display: none;">
                        <circle cx="140" cy="289" r="45" fill="rgba(34, 197, 94, 0.8)" stroke="#16a34a" stroke-width="4"/>
                        <path d="M 122 289 L 135 302 L 158 276" stroke="#ffffff" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="50" stroke-dashoffset="50"/>
                    </g>
                    
                    <!-- Data & Governance Tick -->
                    <g class="completion-tick" data-project="2" style="display: none;">
                        <circle cx="801" cy="500" r="45" fill="rgba(34, 197, 94, 0.8)" stroke="#16a34a" stroke-width="4"/>
                        <path d="M 783 500 L 796 513 L 819 487" stroke="#ffffff" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="50" stroke-dashoffset="50"/>
                    </g>
                    
                    <!-- Analytics & Reporting Tick -->
                    <g class="completion-tick" data-project="3" style="display: none;">
                        <circle cx="234" cy="664" r="45" fill="rgba(34, 197, 94, 0.8)" stroke="#16a34a" stroke-width="4"/>
                        <path d="M 216 664 L 229 677 L 252 651" stroke="#ffffff" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="50" stroke-dashoffset="50"/>
                    </g>
                    
                    <!-- Machine Learning Solutions Tick -->
                    <g class="completion-tick" data-project="4" style="display: none;">
                        <circle cx="823" cy="930" r="45" fill="rgba(34, 197, 94, 0.8)" stroke="#16a34a" stroke-width="4"/>
                        <path d="M 805 930 L 818 943 L 841 917" stroke="#ffffff" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="50" stroke-dashoffset="50"/>
                    </g>
                    
                    <!-- Consumer Research & Insights Tick -->
                    <g class="completion-tick" data-project="5" style="display: none;">
                        <circle cx="201" cy="1040" r="45" fill="rgba(34, 197, 94, 0.8)" stroke="#16a34a" stroke-width="4"/>
                        <path d="M 183 1040 L 196 1053 L 219 1027" stroke="#ffffff" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="50" stroke-dashoffset="50"/>
                    </g>
                    
                    <!-- Martech Tick -->
                    <g class="completion-tick" data-project="6" style="display: none;">
                        <circle cx="559" cy="1408" r="45" fill="rgba(34, 197, 94, 0.8)" stroke="#16a34a" stroke-width="4"/>
                        <path d="M 541 1408 L 554 1421 L 577 1395" stroke="#ffffff" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="50" stroke-dashoffset="50"/>
                    </g>
                </svg>
            </div>
        </div>

        <!-- Logout Button -->
        <div style="text-align: center; margin-top: 30px;">
            <button class="logout-btn" onclick="handleLogout()">
                <span>ðŸšª</span>
                <span>Logout </span>
            </button>
        </div>
    </div>

            <!-- Leaderboard Section -->
            <div class="leaderboard">
                <h2>ðŸ“Š Leaderboard</h2>
                <div id="leaderboard-content">
                    <div class="leaderboard-empty">Visit teams to track your progress here</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get completed projects from server (passed via Jinja template)
        const completedProjects = {% if completed_projects %}{{ completed_projects | tojson }}{% else %}[]{% endif %};
          // Mark completed projects on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Show completion ticks for completed projects
            markCompletedProjects();
            
            // Handle hotspot clicks
            const hotspots = document.querySelectorAll('.hotspot');
            hotspots.forEach(hotspot => {
                hotspot.addEventListener('click', (e) => {
                    const projectId = e.target.getAttribute('data-project');
                    
                    // Don't allow clicking on completed projects
                    if (completedProjects.includes(projectId)) {
                        return false;
                    }
                    
                    goToProject(projectId);
                });
                
                // Visual feedback on hover for non-completed projects only
                hotspot.addEventListener('mouseenter', (e) => {
                    const projectId = e.target.getAttribute('data-project');
                    if (!completedProjects.includes(projectId)) {
                        e.target.setAttribute('fill', 'rgba(255, 255, 255, 0.2)');
                        e.target.setAttribute('stroke', '#fff');
                        e.target.style.cursor = 'pointer';
                    } else {
                        e.target.style.cursor = 'default';
                    }
                });
                
                hotspot.addEventListener('mouseleave', (e) => {
                    const projectId = e.target.getAttribute('data-project');
                    if (!completedProjects.includes(projectId)) {
                        e.target.setAttribute('fill', 'transparent');
                        e.target.setAttribute('stroke', 'transparent');
                    }
                });
            });
        });

        function markCompletedProjects() {
            // Show completion tick icons for completed projects
            completedProjects.forEach(projectId => {
                const tickIcon = document.querySelector(`.completion-tick[data-project="${projectId}"]`);
                if (tickIcon) {
                    tickIcon.style.display = 'block';
                    tickIcon.style.animation = 'fadeInScale 0.5s ease-out';
                }
                
                // Disable the hotspot for completed projects
                const hotspot = document.querySelector(`.hotspot[data-project="${projectId}"]`);
                if (hotspot) {
                    hotspot.style.pointerEvents = 'none';
                    hotspot.style.opacity = '0.5';
                }
            });
        }

        function goToProject(projectId) {
            window.location.href = `/project/${projectId}`;
        }

        async function handleLogout() {
            try {
                const response = await fetch('/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                // Redirect immediately - CSV files saved on server for admin
                window.location.href = '/';
            } catch (error) {
                // Redirect anyway even on error
                window.location.href = '/';
            }
        }

        // Add a subtle animation on load
        document.addEventListener('DOMContentLoaded', () => {
            const cards = document.querySelectorAll('.project-card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.05}s`;
            });
            
            // Update leaderboard on load
            updateLeaderboard();
        });        // Also update leaderboard when page becomes visible (returning from project)
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // Reload the page to get updated completion status
                window.location.reload();
            }
        });

        // Update leaderboard when window gains focus
        window.addEventListener('focus', () => {
            // Reload the page to get updated completion status
            setTimeout(() => {
                window.location.reload();
            }, 500); // Small delay to ensure any background processes complete
        });

        // Function to update leaderboard with sorted project times
        function updateLeaderboard() {
            fetch('/get-project-times')
                .then(response => response.json())
                .then(data => {
                    const leaderboardContent = document.getElementById('leaderboard-content');
                    
                    if (data.times && data.times.length > 0) {
                        // Sort by duration in descending order (longest time first)
                        const sortedTimes = data.times.sort((a, b) => b.duration - a.duration);
                        
                        let html = '';
                        sortedTimes.forEach(item => {
                            html += `
                                <div class="leaderboard-item">
                                    <div class="leaderboard-item-name">${item.project_name}</div>
                                    <div class="leaderboard-item-time">${item.time_spent}</div>
                                </div>
                            `;
                        });
                        leaderboardContent.innerHTML = html;
                    } else {
                        leaderboardContent.innerHTML = '<div class="leaderboard-empty">Visit teams to track your progress here</div>';
                    }
                })
                .catch(error => {
                    console.error('Error loading leaderboard:', error);
                });
        }
    </script>
</body>
</html>
